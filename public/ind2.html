<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Health Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #0f172a;
            color: #e2e8f0;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid #334155;
            margin-bottom: 30px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo i {
            font-size: 2.5rem;
            color: #3b82f6;
        }
        
        .logo h1 {
            font-size: 2rem;
            font-weight: 700;
        }
        
        .controls {
            display: flex;
            gap: 15px;
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2563eb;
        }
        
        .btn-secondary {
            background-color: #334155;
            color: #e2e8f0;
        }
        
        .btn-secondary:hover {
            background-color: #475569;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background-color: #1e293b;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            padding: 5px 12px;
            border-radius: 20px;
            background-color: #334155;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        .status-ok {
            background-color: #10b981;
        }
        
        .status-error {
            background-color: #ef4444;
        }
        
        .status-warning {
            background-color: #f59e0b;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #94a3b8;
            font-size: 0.9rem;
        }
        
        .chart-container {
            height: 300px;
            margin-top: 10px;
        }
        
        .api-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .api-card {
            background-color: #1e293b;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .api-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .api-name {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }
        
        .api-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        
        .vt-icon {
            background-color: #7c3aed;
        }
        
        .ow-icon {
            background-color: #3b82f6;
        }
        
        .abuse-icon {
            background-color: #ef4444;
        }
        
        .api-stats {
            margin: 15px 0;
        }
        
        .api-stat {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #334155;
        }
        
        .api-stat:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .history-container {
            margin-top: 30px;
        }
        
        .history-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .history-table {
            width: 100%;
            border-collapse: collapse;
            background-color: #1e293b;
            border-radius: 12px;
            overflow: hidden;
        }
        
        .history-table th, .history-table td {
            padding: 15px;
            text-align: left;
        }
        
        .history-table th {
            background-color: #334155;
            font-weight: 600;
        }
        
        .history-table tr {
            border-bottom: 1px solid #334155;
        }
        
        .history-table tr:last-child {
            border-bottom: none;
        }
        
        .badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .badge-success {
            background-color: #10b98120;
            color: #10b981;
        }
        
        .badge-error {
            background-color: #ef444420;
            color: #ef4444;
        }
        
        .badge-warning {
            background-color: #f59e0b20;
            color: #f59e0b;
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 4px solid #3b82f6;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-message {
            background-color: #ef444420;
            color: #ef4444;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .config-panel {
            background-color: #1e293b;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .config-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .config-form {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .config-input {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #334155;
            background-color: #0f172a;
            color: #e2e8f0;
            flex-grow: 1;
        }
        /* ========== Stat Cards Icon Row Enhancements ========== */
        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: .5rem;
        }

        .stat-info {
            display: flex;
            flex-direction: column;
        }

        .stat-icon {
            font-size: 1.5rem;
            padding: 0.6rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Default colors */
        #uptimeBadge { background: rgba(16,185,129,0.15); color: #10b981; }
        #responseTimeBadge { background: rgba(124,58,237,0.15); color: #7c3aed; }
        #requestsBadge { background: rgba(59,130,246,0.15); color: #3b82f6; }

        /* Dynamic states */
        .uptime-good { background: rgba(16,185,129,0.2) !important; color: #10b981 !important; }
        .uptime-warning { background: rgba(245,158,11,0.2) !important; color: #f59e0b !important; }
        .uptime-bad { background: rgba(239,68,68,0.2) !important; color: #ef4444 !important; }

        .rt-good { background: rgba(16,185,129,0.2) !important; color: #10b981 !important; }
        .rt-warning { background: rgba(245,158,11,0.2) !important; color: #f59e0b !important; }
        .rt-bad { background: rgba(239,68,68,0.2) !important; color: #ef4444 !important; }


        /* CYBERPUNK SIDEBAR WITH COLLAPSED ICON STRIP */
        /* Import futuristic font */
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600&display=swap');

        #sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100%;
            width: 60px; /* collapsed width */
            background: linear-gradient(180deg, #0a0f1c, #111827 70%, #0a0f1c);
            color: #38bdf8;
            padding-top: 60px;
            transition: width 0.3s ease;
            z-index: 1000;
            border-right: 1px solid rgba(56,189,248,0.2);
            box-shadow: 0 0 12px rgba(56,189,248,0.15);
            overflow-x: hidden;

            display: flex;              /* flex column */
            flex-direction: column;
            justify-content: space-between; /* top items & bottom settings */
        }

        /* Expand on hover */
        #sidebar:hover {
            width: 200px;
            box-shadow: 0 0 25px rgba(56,189,248,0.3), 
                        inset 0 0 20px rgba(56,189,248,0.05);
        }

        /* Sidebar list (top items) */
        #sidebar .nav-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        /* Sidebar bottom section */
        #sidebar .sidebar-bottom {
            list-style: none;
            padding: 0;
            margin: 0;
            border-top: 1px solid rgba(56,189,248,0.15);
        }

        /* Shared list item styles */
        #sidebar ul li,
        #sidebar .sidebar-bottom li {
            padding: 14px 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s;
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            letter-spacing: 0.5px;
            white-space: nowrap;
            color: #94a3b8;
        }

        /* Icons (always visible) */
        #sidebar ul li i,
        #sidebar .sidebar-bottom li i {
            font-size: 20px;
            color: #38bdf8;
            min-width: 30px;
            text-align: center;
            transition: 0.3s;
        }

        /* Hover effects */
        #sidebar ul li:hover,
        #sidebar .sidebar-bottom li:hover {
            background: rgba(56,189,248,0.08);
            box-shadow: inset 0 0 10px rgba(56,189,248,0.2);
            color: #e2e8f0;
        }

        #sidebar ul li:hover i,
        #sidebar .sidebar-bottom li:hover i {
            color: #7dd3fc;
        }

        /* Hide text until expanded */
        .nav-text {
            opacity: 0;
            max-width: 0;
            overflow: hidden;
            transition: all 0.3s;
        }

        /* Show text when expanded */
        #sidebar:hover .nav-text {
            opacity: 1;
            max-width: 150px;
            color: #e2e8f0;
        }



        /* ========== MODAL STYLES ========== */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 2000; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%;
            overflow: auto; 
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: #1e293b;
            margin: 10% auto; 
            padding: 20px;
            border-radius: 12px;
            width: 400px;
            color: #e2e8f0;
            position: relative;
        }

        .modal-content h2 {
            margin-bottom: 20px;
        }

        .modal-content input {
            width: 100%;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #334155;
            background-color: #0f172a;
            color: #e2e8f0;
        }

        .modal-content .close {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            color: #e2e8f0;
        }


        @media (max-width: 1200px) {
            .dashboard, .api-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .dashboard, .api-grid {
                grid-template-columns: 1fr;
            }
            
            header {
                flex-direction: column;
                gap: 20px;
            }
            
            .config-form {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- LEFT SIDEBAR -->
    <!-- <div id="sidebar">
        <ul>
            <li><i class="fas fa-database"></i> <span class="nav-text">API List</span></li>
            <li><i class="fas fa-server"></i> <span class="nav-text">Servers</span></li>
            <li><i class="fas fa-chart-line"></i> <span class="nav-text">Stats</span></li>
        </ul>
        <div class="sidebar-bottom">
            <li><i class="fas fa-cog"></i> <span class="nav-text">Settings</span></li>
        </div>
    </div> -->

      <!-- Sidebar -->
    <div id="sidebar">
        <ul class="nav-list">
        <li>
            <a href="ind2.html">
                <i class="fas fa-home"></i>
                <span class="nav-text">Dashboard</span>
            </a>
        </li>
        <li>
            <a href="pages/api-list.html">
            <i class="fas fa-key"></i><span class="nav-text">API List</span>
            </a>
        </li>
        <li>
            <a href="pages/server.html">
            <i class="fas fa-server"></i><span class="nav-text">Server</span>
            </a>
        </li>
        <li>
            <a href="pages/stats.html">
            <i class="fas fa-chart-bar"></i><span class="nav-text">Stats</span>
            </a>
        </li>
        </ul>
        <ul class="sidebar-bottom">
        <li>
            <a href="pages/settings.html">
            <i class="fas fa-cog"></i><span class="nav-text">Settings</span>
            </a>
        </li>
        </ul>
    </div>

    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-heartbeat"></i>
                <h1>API Health Dashboard</h1>
            </div>
            <div class="controls">
                <button class="btn btn-primary" id="refreshBtn">
                    <i class="fas fa-sync-alt"></i> Refresh Data
                </button>
                <button class="btn btn-secondary" id="settingsBtn">
                    <i class="fas fa-cog"></i> Settings
                </button>
                <button class="btn btn-primary" id="addApiBtn">
                    <i class="fas fa-plus"></i> Add API Key
                </button>
            </div>
        </header>
        
        <div id="configPanel" class="config-panel" style="display: none;">
            <div class="config-title">Backend Configuration</div>
            <div class="config-form">
                <input type="text" id="backendUrl" class="config-input" placeholder="Backend URL (e.g., http://localhost:3000)">
                <input type="text" id="healthEndpoint" class="config-input" placeholder="Health Endpoint (e.g., /health)">
                <input type="text" id="statsEndpoint" class="config-input" placeholder="Stats Endpoint (e.g., /stats)">
                <button class="btn btn-primary" id="saveConfigBtn">Save</button>
            </div>
        </div>
        
        <div id="errorContainer" style="display: none;" class="error-message">
            <i class="fas fa-exclamation-circle"></i>
            <span id="errorText">Failed to connect to the backend server.</span>
        </div>
        
        <div id="dashboardContent">
            <div class="dashboard">
                <!-- Uptime -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Uptime Status</div>
                        <div class="status-indicator">
                            <div class="status-dot status-ok"></div>
                            <span id="uptimeStatusText">All Systems Operational</span>
                        </div>
                    </div>
                    <div class="stat-row">
                        <div class="stat-info">
                            <div class="stat-value" id="uptimeValue">99.95%</div>
                            <div class="stat-label">Last 30 days</div>
                        </div>
                        <div class="stat-icon" id="uptimeBadge">
                            <i class="fas fa-check-circle"></i>
                        </div>
                    </div>
                </div>

                <!-- Avg Response Time -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Average Response Time</div>
                    </div>
                    <div class="stat-row">
                        <div class="stat-info">
                            <div class="stat-value" id="responseTimeValue">248ms</div>
                            <div class="stat-label">Across all APIs</div>  
                        </div>
                        <div class="stat-icon" id="responseTimeBadge">
                            <i class="fas fa-tachometer-alt"></i>
                        </div>
                    </div>
                </div>

                <!-- API Requests -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">API Requests</div>
                    </div>
                    <div class="stat-row">
                        <div class="stat-info">
                            <div class="stat-value" id="apiRequestsValue">12,482</div>
                            <div class="stat-label">Today</div>
                        </div>
                        <div class="stat-icon" id="requestsBadge">
                            <i class="fas fa-network-wired"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>      
           
        <div class="api-grid">
                <!-- VirusTotal Card -->
                <div class="api-card" id="vt-card">
                    <div class="api-card-header">
                        <div class="api-name">
                            <div class="api-icon vt-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <span>VirusTotal</span>
                        </div>
                        <div class="status-indicator">
                            <div class="status-dot status-ok"></div>
                            <span>Online</span>
                        </div>
                    </div>
                    <div class="api-stats">
                        <div class="api-stat">
                            <span>Status</span>
                            <span class="badge badge-success status-badge">Operational</span>
                        </div>
                        <div class="api-stat">
                            <span>Response Time</span>
                            <span class="response-time">320ms</span>
                        </div>
                        <div class="api-stat">
                            <span>Last Checked</span>
                            <span class="last-checked">Just now</span>
                        </div>
                    </div>
                </div>

                <!-- OpenWeatherMap Card -->
                <div class="api-card" id="ow-card">
                    <div class="api-card-header">
                        <div class="api-name">
                            <div class="api-icon ow-icon">
                                <i class="fas fa-cloud-sun"></i>
                            </div>
                            <span>OpenWeatherMap</span>
                        </div>
                        <div class="status-indicator">
                            <div class="status-dot status-ok"></div>
                            <span>Online</span>
                        </div>
                    </div>
                    <div class="api-stats">
                        <div class="api-stat">
                            <span>Status</span>
                            <span class="badge badge-success status-badge">Operational</span>
                        </div>
                        <div class="api-stat">
                            <span>Response Time</span>
                            <span class="response-time">180ms</span>
                        </div>
                        <div class="api-stat">
                            <span>Last Checked</span>
                            <span class="last-checked">Just now</span>
                        </div>
                    </div>
                </div>

                <!-- AbuseIPDB Card -->
                <div class="api-card" id="abuse-card">
                    <div class="api-card-header">
                        <div class="api-name">
                            <div class="api-icon abuse-icon">
                                <i class="fas fa-ban"></i>
                            </div>
                            <span>AbuseIPDB</span>
                        </div>
                        <div class="status-indicator">
                            <div class="status-dot status-warning"></div>
                            <span>Degraded</span>
                        </div>
                    </div>
                    <div class="api-stats">
                        <div class="api-stat">
                            <span>Status</span>
                            <span class="badge badge-warning status-badge">Slow Response</span>
                        </div>
                        <div class="api-stat">
                            <span>Response Time</span>
                            <span class="response-time">820ms</span>
                        </div>
                        <div class="api-stat">
                            <span>Last Checked</span>
                            <span class="last-checked">Just now</span>
                        </div>
                    </div>
                </div>
            </div>

            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Response Time History (Last 24 Hours)</div>
                </div>
                <div class="chart-container">
                    <canvas id="responseTimeChart"></canvas>
                </div>
            </div>
            
            <div class="history-container">
                <h2 class="history-title">Recent API Checks</h2>
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>API</th>
                            <th>Timestamp</th>
                            <th>Status</th>
                            <th>HTTP Status</th>
                            <th>Response Time</th>
                        </tr>
                    </thead>
                    <tbody id="historyBody">
                        <tr>
                            <td>VirusTotal</td>
                            <td>2023-07-18 14:25:32</td>
                            <td><span class="badge badge-success">OK</span></td>
                            <td>200</td>
                            <td>320ms</td>
                        </tr>
                        <tr>
                            <td>OpenWeatherMap</td>
                            <td>2023-07-18 14:25:30</td>
                            <td><span class="badge badge-success">OK</span></td>
                            <td>200</td>
                            <td>180ms</td>
                        </tr>
                        <tr>
                            <td>AbuseIPDB</td>
                            <td>2023-07-18 14:25:28</td>
                            <td><span class="badge badge-warning">Slow Response</span></td>
                            <td>200</td>
                            <td>820ms</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

         <!-- ADD NEW API KEY MODAL -->
        <div id="addApiModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Add New API Key</h2>
                <form id="addApiForm">
                    <input type="text" placeholder="API Name" required>
                    <input type="text" placeholder="API Key" required>
                    <button type="submit" class="btn btn-primary">Add Key</button>
                </form>
            </div>
        </div>
        
        <div id="loadingIndicator" class="loading" style="display: none;">
            <div class="spinner"></div>
            <span>Connecting to backend...</span>
        </div>
    </div>
    <script>
                // API configuration with default values
            let backendConfig = {
                url: 'http://localhost:3000',
                healthEndpoint: '/health',
                statsEndpoint: '/stats'
            };

            let isBackendConnected = false;

            // Dummy data
            const dummyData = {
                uptime: 99.95,
                responseTime: 248,
                apiRequests: 12482
            };

            // Chart storage
            const chartData = {
                labels: [],
                datasets: [
                    {
                        label: 'VirusTotal',
                        data: [],
                        borderColor: '#7c3aed',
                        backgroundColor: 'rgba(124, 58, 237, 0.1)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'OpenWeatherMap',
                        data: [],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'AbuseIPDB',
                        data: [],
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4,
                        fill: true
                    }
                ]
            };

            let responseTimeChart;
            function initChart() {
                const ctx = document.getElementById('responseTimeChart').getContext('2d');
                responseTimeChart = new Chart(ctx, {
                    type: 'line',
                    data: chartData,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: { color: '#e2e8f0' }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { color: '#e2e8f0' }
                            },
                            x: {
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { color: '#e2e8f0' }
                            }
                        }
                    }
                });
            }

            // Fetch data from backend
            async function fetchData() {
                showLoading();
                hideError();

                try {
                    const healthResponse = await fetch(`${backendConfig.url}${backendConfig.healthEndpoint}`);
                    if (!healthResponse.ok) throw new Error(`Health endpoint error! status: ${healthResponse.status}`);
                    const healthData = await healthResponse.json();

                    let statsData = null;
                    try {
                        const statsResponse = await fetch(`${backendConfig.url}${backendConfig.statsEndpoint}`);
                        if (statsResponse.ok) {
                            statsData = await statsResponse.json();
                        }
                    } catch {
                        const totalResponseTime = healthData.reduce((sum, api) => sum + (parseInt(api.responseTime) || 0), 0);
                        const avgResponseTime = healthData.length > 0 ? Math.round(totalResponseTime / healthData.length) : 0;
                        const uptime = healthData.length > 0 ?
                            (healthData.filter(api => api.status === 'OK').length / healthData.length * 100).toFixed(2) : 0;
                        statsData = {
                            avgResponseTime: avgResponseTime,
                            uptime: parseFloat(uptime),
                            apiRequests: Math.floor(Math.random() * 1000) + 10000
                        };
                    }

                    isBackendConnected = true;
                    updateDashboard(healthData, statsData);
                    hideLoading();
                } catch (error) {
                    console.error('Error fetching data:', error);
                    isBackendConnected = false;
                    showError(`Failed to connect to backend: ${error.message}. Using simulated data.`);
                    hideLoading();
                    simulateData();
                }
            }

            // Update dashboard
            function updateDashboard(healthData, statsData) {
                healthData.forEach(apiData => updateApiCard(apiData));
                updateChart(healthData);
                addToHistory(healthData);

                if (statsData) {
                    updateDashboardCards({
                        uptime: statsData.uptime || 0,
                        responseTime: statsData.avgResponseTime || 0,
                        apiRequests: statsData.apiRequests || 0,
                        statusText: (statsData.uptime || 0) >= 99.5 ? 'All Systems Operational' : 'Partial Outage'
                    });
                }
            }

            function updateDashboardCards(data) {
                // Update values
                document.getElementById('uptimeValue').textContent = `${data.uptime}%`;
                document.getElementById('responseTimeValue').textContent = `${data.responseTime}ms`;
                document.getElementById('apiRequestsValue').textContent = data.apiRequests.toLocaleString();
                document.getElementById('uptimeStatusText').textContent = data.statusText;

                // Dynamic uptime badge
                const uptimeBadge = document.getElementById('uptimeBadge');
                uptimeBadge.classList.remove('uptime-good', 'uptime-warning', 'uptime-bad');
                if (data.uptime >= 99.5) uptimeBadge.classList.add('uptime-good');
                else if (data.uptime >= 95) uptimeBadge.classList.add('uptime-warning');
                else uptimeBadge.classList.add('uptime-bad');

                // Dynamic response time badge
                const rtBadge = document.getElementById('responseTimeBadge');
                rtBadge.classList.remove('rt-good', 'rt-warning', 'rt-bad');
                if (data.responseTime < 500) rtBadge.classList.add('rt-good');
                else if (data.responseTime < 1000) rtBadge.classList.add('rt-warning');
                else rtBadge.classList.add('rt-bad');
            }


            // Update API cards
            function updateApiCard(apiData) {
                let cardId = '';
                if (apiData.platform === 'VirusTotal') cardId = 'vt-card';
                else if (apiData.platform === 'OpenWeatherMap') cardId = 'ow-card';
                else if (apiData.platform === 'AbuseIPDB') cardId = 'abuse-card';

                const card = document.getElementById(cardId);
                if (!card) return;

                const isOk = apiData.status === 'OK';
                const isError = apiData.status.includes('Error');
                const statusClass = isOk ? 'status-ok' : isError ? 'status-error' : 'status-warning';
                const statusText = isOk ? 'Online' : isError ? 'Error' : 'Degraded';

                const statusDot = card.querySelector('.status-dot');
                const statusTextEl = card.querySelector('.status-indicator span:last-child');
                if (statusDot) statusDot.className = 'status-dot ' + statusClass;
                if (statusTextEl) statusTextEl.textContent = statusText;

                const badge = card.querySelector('.badge');
                if (badge) {
                    badge.textContent = isOk ? 'Operational' : isError ? apiData.status : 'Slow Response';
                    badge.className = 'badge ' + (isOk ? 'badge-success' : isError ? 'badge-error' : 'badge-warning');
                }

                const responseTimeEl = card.querySelector('.api-stat:nth-child(2) span:last-child');
                if (responseTimeEl) responseTimeEl.textContent = apiData.responseTime || 'N/A';

                const lastCheckedEl = card.querySelector('.api-stat:nth-child(3) span:last-child');
                if (lastCheckedEl) lastCheckedEl.textContent = new Date().toLocaleTimeString();
            }

            // Update chart
            function updateChart(data) {
                const now = new Date();
                const timeLabel = now.getHours() + ':' + now.getMinutes().toString().padStart(2, '0');
                chartData.labels.push(timeLabel);
                if (chartData.labels.length > 15) chartData.labels.shift();

                data.forEach(apiData => {
                    let idx = -1;
                    if (apiData.platform === 'VirusTotal') idx = 0;
                    else if (apiData.platform === 'OpenWeatherMap') idx = 1;
                    else if (apiData.platform === 'AbuseIPDB') idx = 2;

                    if (idx >= 0) {
                        const responseTimeValue = parseInt(apiData.responseTime) || 0;
                        chartData.datasets[idx].data.push(responseTimeValue);
                        if (chartData.datasets[idx].data.length > 15) {
                            chartData.datasets[idx].data.shift();
                        }
                    }
                });
                if (responseTimeChart) responseTimeChart.update();
            }

            // Add to history (Recent API checks)
            function addToHistory(data) {
                const historyBody = document.getElementById('historyBody');
                if (!historyBody) return;

                const now = new Date();

                data.forEach(apiData => {
                    const newRow = document.createElement('tr');

                    const isOk = apiData.status === 'OK';
                    const isError = apiData.status.includes('Error');
                    const badgeClass = isOk ? 'badge-success' : isError ? 'badge-error' : 'badge-warning';

                    newRow.innerHTML = `
                        <td>${apiData.platform}</td>
                        <td>${now.toLocaleString()}</td>
                        <td><span class="badge ${badgeClass}">${apiData.status}</span></td>
                        <td>${apiData.httpStatus || 'N/A'}</td>
                        <td>${apiData.responseTime || 'N/A'}</td>
                    `;

                    historyBody.prepend(newRow);
                });

                while (historyBody.children.length > 15) {
                    historyBody.removeChild(historyBody.lastChild);
                }
            }

            // Simulate data
            function simulateData() {
                const simulatedData = [
                    {
                        platform: 'VirusTotal',
                        status: 'OK',
                        httpStatus: 200,
                        responseTime: `${Math.floor(Math.random() * 100) + 250}ms`,
                        timestamp: new Date().toISOString()
                    },
                    {
                        platform: 'OpenWeatherMap',
                        status: 'OK',
                        httpStatus: 200,
                        responseTime: `${Math.floor(Math.random() * 100) + 150}ms`,
                        timestamp: new Date().toISOString()
                    },
                    {
                        platform: 'AbuseIPDB',
                        status: Math.random() > 0.7 ? 'Error: Rate Limit Exceeded' : (Math.random() > 0.8 ? 'Slow Response' : 'OK'),
                        httpStatus: Math.random() > 0.7 ? 429 : 200,
                        responseTime: `${Math.floor(Math.random() * 400) + 400}ms`,
                        timestamp: new Date().toISOString()
                    }
                ];

                dummyData.uptime = (99 + Math.random()).toFixed(2);
                dummyData.responseTime = Math.floor(200 + Math.random() * 100);
                dummyData.apiRequests += Math.floor(Math.random() * 100);

                updateDashboard(simulatedData, {
                    uptime: dummyData.uptime,
                    responseTime: dummyData.responseTime,
                    apiRequests: dummyData.apiRequests,
                    statusText: dummyData.uptime >= 99.5 ? 'All Systems Operational' : 'Partial Outage'
                });
            }

            // UI helpers
            function showLoading() {
                const loadingIndicator = document.getElementById('loadingIndicator');
                const dashboardContent = document.getElementById('dashboardContent');
                if (loadingIndicator) loadingIndicator.style.display = 'flex';
                if (dashboardContent) dashboardContent.style.opacity = '0.5';
            }
            function hideLoading() {
                const loadingIndicator = document.getElementById('loadingIndicator');
                const dashboardContent = document.getElementById('dashboardContent');
                if (loadingIndicator) loadingIndicator.style.display = 'none';
                if (dashboardContent) dashboardContent.style.opacity = '1';
            }
            function showError(message) {
                const errorText = document.getElementById('errorText');
                const errorContainer = document.getElementById('errorContainer');
                if (errorText) errorText.textContent = message;
                if (errorContainer) errorContainer.style.display = 'flex';
            }
            function hideError() {
                const errorContainer = document.getElementById('errorContainer');
                if (errorContainer) errorContainer.style.display = 'none';
            }
            function toggleConfigPanel() {
                const panel = document.getElementById('configPanel');
                if (panel) {
                    panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
                }
            }

            // Init
            document.addEventListener('DOMContentLoaded', function() {
                initChart();
                simulateData();
                fetchData();

                setInterval(() => {
                    if (isBackendConnected) {
                        fetchData();
                    } else {
                        simulateData();
                    }
                }, 40000);

                // Refresh button
                const refreshBtn = document.getElementById('refreshBtn');
                if (refreshBtn) {
                    refreshBtn.addEventListener('click', function() {
                        if (isBackendConnected) fetchData();
                        else simulateData();
                    });
                }

                // Settings button
                const settingsBtn = document.getElementById('settingsBtn');
                if (settingsBtn) {
                    settingsBtn.addEventListener('click', function() {
                        toggleConfigPanel();
                    });
                }

                // Save config
                const saveConfigBtn = document.getElementById('saveConfigBtn');
                if (saveConfigBtn) {
                    saveConfigBtn.addEventListener('click', function() {
                        backendConfig.url = document.getElementById('backendUrl').value || 'http://localhost:3000';
                        backendConfig.healthEndpoint = document.getElementById('healthEndpoint').value || '/health';
                        backendConfig.statsEndpoint = document.getElementById('statsEndpoint').value || '/stats';
                        localStorage.setItem('apiDashboardConfig', JSON.stringify(backendConfig));
                        alert('Configuration saved!');
                        fetchData();
                    });
                }
            });
    </script>

    <script>
        const addApiBtn = document.getElementById('addApiBtn');
        const addApiModal = document.getElementById('addApiModal');
        const closeModal = addApiModal.querySelector('.close');

        addApiBtn.addEventListener('click', () => {
            addApiModal.style.display = 'block';
        });

        closeModal.addEventListener('click', () => {
            addApiModal.style.display = 'none';
        });

        window.addEventListener('click', (e) => {
            if (e.target === addApiModal) addApiModal.style.display = 'none';
        });

        // Simulated form submission
        document.getElementById('addApiForm').addEventListener('submit', (e) => {
            e.preventDefault();
            alert('API Key Added (simulation)');
            addApiModal.style.display = 'none';
        });
    </script>
    
</body>
</html>